webpackJsonp([34],{FxGV:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("woOf"),i=s.n(a),n=s("Xxa5"),o=s.n(n),r=s("exGp"),c=s.n(r),l=s("gyMJ"),u={name:"notice",mixins:[s("a9+M").a],data:function(){return{long:0,time:0,popupShow:!1,className:this.$route.query.className,classId:this.$route.query.classId,index:0,isLoading:!1,totalPage:1,query:{openId:this.$route.query.openId,classId:this.$route.query.classId,studentId:this.$route.query.studentId,type:0,page:1,pageSize:10},roleType:this.$route.query.roleType,noticeData:[],classList:[]}},filters:{brReplace:function(e){return e?e.replace(/<br\/>/g,""):""}},methods:{onClose:function(e,t){var s=this;return function(a,i){switch(a){case"right":s.$dialog.confirm({title:"提示",message:"确认要删除该条公告吗?"}).then(c()(o.a.mark(function a(){var i;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i={openId:s.query.openId,noticeId:e.noticeId,classId:e.classId},a.next=3,l.a.deleteNotice(i);case 3:0===a.sent.errorCode&&s.noticeData.splice(t,1);case 5:case"end":return a.stop()}},a,s)}))).catch(function(){i.close()})}}},go:function(e){var t=e.noticeId,s=e.needConfirm,a=e.classId,i=e.studentId,n=this.query.openId,o=this.roleType;this.$router.push({path:"/notice/show",query:{noticeId:t,needConfirm:s,classId:a,studentId:i,openId:n,roleType:o}})},handleTabClick:function(e,t){this.index=e,this.query.page=1,this.query.type=e,this.noticeQuery(this.query)},handleClassConfirm:function(e){this.popupShow=!1,this.className=e.className,this.query.classId=e.classId,this.noticeQuery(this.query)},handleLoadingMore:function(e){var t=this,s=0;if(document.documentElement&&document.documentElement.scrollTop?s=document.documentElement.scrollTop:document.body&&(s=document.body.scrollTop),document.body.offsetHeight-s-window.innerHeight<=200&&!1===this.isLoading&&this.query.page<this.totalPage){this.isLoading=!0,this.query.page+=1;var a=1===this.roleType?0:this.$store.state.users.classId,n=i()({},this.query,{classId:a});l.a.noticeQuery(n).then(function(e){if(0===e.errorCode){t.totalPage=e.data.totalPage,t.query.page=e.data.page,t.isLoading=!1;var s=e.data.data;s.length&&s.forEach(function(e){t.noticeData.push(e)})}})}},noticeQuery:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c()(o.a.mark(function s(){var a;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,l.a.noticeQuery(t);case 2:0===(a=s.sent).errorCode&&(e.popupShow=!1,e.query.page=a.data.page,e.totalPage=a.data.totalPage,e.isLoading=!1,e.noticeData=a.data.data||[]);case 4:case"end":return s.stop()}},s,e)}))()},queryClassGroup:function(){var e=this;return c()(o.a.mark(function t(){var s,a,i,n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.$route.query,a=s.id,i=s.studentId,n=s.roleType,t.next=3,l.a.queryClassId({id:a,studentId:i,roleType:n});case 3:0===(r=t.sent).errorCode&&(e.classList=r.data);case 5:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.queryClassGroup(),this.wxSdk.wxShare(this.roleType),this.noticeQuery(this.query)}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{staticClass:"page-hd"},[1==e.roleType||4==e.roleType||2==e.roleType?[a("div",{staticClass:"button-sp-area flex",attrs:{"size-17":""}},[a("a",{attrs:{href:"javascript:;",id:"showDatePicker"},on:{click:function(t){e.popupShow=!0}}},[a("span",[e._v(e._s(e.className))]),e._v(" "),a("van-icon",{attrs:{name:"arrow-down",size:"16px"}})],1)])]:e._e(),e._v(" "),1==e.roleType||4==e.roleType?[a("van-tabs",{attrs:{"line-height":2},on:{click:e.handleTabClick},model:{value:e.index,callback:function(t){e.index=t},expression:"index"}},[a("van-tab",{attrs:{title:"通知消息"}}),e._v(" "),a("van-tab",{attrs:{title:"发送记录"}})],1)]:e._e()],2),e._v(" "),a("div",{staticClass:"page-bd"},[a("van-popup",{attrs:{position:"bottom"},model:{value:e.popupShow,callback:function(t){e.popupShow=t},expression:"popupShow"}},[a("div",{staticClass:"popup-class"},[a("div",{staticClass:"cells"},e._l(e.classList,function(t,i){return a("div",{key:i,staticClass:"cell popup-box"},[a("div",{staticClass:"cell-hd"},[a("img",{attrs:{src:s("UHh/"),width:"54",height:"54"}})]),e._v(" "),a("div",{staticClass:"cell-bd"},[a("p",[e._v(e._s(t.className))])]),e._v(" "),a("div",{staticClass:"cell-ft"},[a("van-radio-group",{model:{value:e.classId,callback:function(t){e.classId=t},expression:"classId"}},[a("van-radio",{attrs:{name:t.classId,"checked-color":"#92cd36"},on:{click:function(s){e.handleClassConfirm(t)}}})],1)],1)])}))])]),e._v(" "),1==e.roleType||4==e.roleType?[a("router-link",{staticClass:"release",attrs:{to:{path:"/notice/add",query:{openId:this.$route.query.openId}}}},[a("van-icon",{attrs:{name:"description",size:"24px"}})],1)]:e._e(),e._v(" "),e._l(e.noticeData,function(t,s){return a("van-swipe-cell",{key:s,ref:"swipeCell",refInFor:!0,attrs:{"right-width":60,disabled:1!==e.roleType,"on-close":e.onClose(t,s)}},[a("van-cell-group",[a("figure",{staticClass:"figure figure-skin-one",on:{click:function(s){e.go(t)}}},[a("div",{staticClass:"figure-bd"},[t.topImage?a("div",{staticClass:"figure-thumb-small",style:{backgroundImage:"url("+t.topImage+")"}}):e._e(),e._v(" "),a("div",{staticClass:"figure-info"},[a("figcaption",{staticClass:"text-ellipsis"},[t.status?e._e():a("i",{staticStyle:{width:"6px",height:"6px"}}),e._v(" "),a("span",{attrs:{"size-18":""}},[e._v(e._s(t.title))])]),e._v(" "),a("p",{staticClass:"text-ellipsis",attrs:{"size-15":""}},[e._v(e._s(e._f("brReplace")(t.textContent)))]),e._v(" "),a("div",{staticClass:"metedata flex"},[a("span",{staticClass:"name"},[e._v(e._s(t.name))]),e._v(" "),a("time",{staticClass:"time"},[e._v(e._s(t.postTime))])])])]),e._v(" "),a("div",{staticClass:"figure-ft"},[a("div",{staticClass:"figure-total"},[a("span",[e._v("已读"+e._s(t.classReadCount)+"人")]),e._v(" "),1==e.roleType||4==e.roleType?a("span",[e._v("共"+e._s(t.totalCount)+"人")]):e._e()])])])]),e._v(" "),a("span",{staticStyle:{"line-height":"80px"},attrs:{slot:"right"},slot:"right"},[e._v("删除")])],1)}),e._v(" "),e.noticeData.length?e._e():a("div",{staticClass:"empty"},[a("img",{attrs:{src:s("UHh/"),alt:""}}),e._v(" "),a("p",[e._v("暂无通知公告")])])],2)])},staticRenderFns:[]};var p=s("VU/8")(u,d,!1,function(e){s("dBFC")},"data-v-3c5c61fe",null);t.default=p.exports},dBFC:function(e,t){}});