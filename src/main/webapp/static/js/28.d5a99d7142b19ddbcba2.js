webpackJsonp([28],{"7hQ5":function(e,t){},M4vj:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Xxa5"),i=s.n(a),l=s("exGp"),n=s.n(l),r=s("Dd8w"),o=s.n(r),c=s("gyMJ"),d=s("NYxO"),u=s("MqaO"),f={name:"homeWorkAdd",data:function(){return{serverId:[],imagesList:[],selected:[],needSwitch:!1,form:{openId:this.$route.query.openId,title:"",textContent:"",images:[],needConfirm:0,senders:[]}}},computed:o()({},Object(d.b)("users",{roleType:function(e){return e.roleType},id:function(e){return e.id}}),Object(d.b)("queryClass",{classList:function(e){return e.classList}})),methods:{handleChooseImage:function(){var e=this;wx.chooseImage({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){var s=t.localIds;window.__wxjs_is_wkwebview?e.handleLocalImgData(s):s.forEach(function(t){e.imagesList.push(t)}),e.handleUploadImage(s)},fail:function(e){alert("失败")}})},handlePreviewImage:function(e){wx.previewImage({current:e,urls:this.imagesList})},handleUploadImage:function(e){var t=this,s=0,a=e.length;!function i(){var l=e[s];window.__wxjs_is_wkwebview&&-1!=l.indexOf("wxlocalresource")&&(l=l.replace("wxlocalresource","wxLocalResource")),wx.uploadImage({localId:l,isShowProgressTips:1,success:function(e){var l=e.serverId;t.serverId.push(l),++s<a&&i()},fail:function(e){alert("失败")}})}()},handleLocalImgData:function(e){var t=this,s=0,a=e.length;!function i(){wx.getLocalImgData({localId:e[s],success:function(e){var l=e.localData;l=l.replace("jgp","jpeg"),t.imagesList.push(l),++s<a&&i()}})}()},handleDelImg:function(e){this.imagesList.splice(e,1),this.serverId.splice(e,1)},handleSubmit:function(){var e=this,t=this.form,s=t.title,a=t.textContent;if(""!=s)if(""!=a||this.serverId.length)if(this.form.textContent=Object(u.a)(a)||"",this.selected.length){this.needSwitch&&(this.form.needConfirm=1),this.form.senders=this.selected.map(function(e){return{classId:e}});var i={openId:this.form.openId,imgIds:this.serverId};this.serverId.length?c.a.imgIds(i).then(function(t){0===t.errorCode&&(e.form.images=t.data.paths,c.a.homeworkAdd(e.form).then(function(t){0===t.errorCode&&(e.$refs.form.reset(),e.$router.go(-1))}))}):this.homeworkAdd(this.form)}else this.$toast("请选择发送班级");else this.$toast("请输入作业内容或者上传图片");else this.$toast("请输入作业标题")},homeworkAdd:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n()(i.a.mark(function s(){return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,c.a.homeworkAdd(t);case 2:0===s.sent.errorCode&&e.$router.go(-1);case 4:case"end":return s.stop()}},s,e)}))()}},mounted:function(){}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"pages"},[s("div",{staticClass:"page-bd"},[s("form",{ref:"form",attrs:{action:"",method:"post"}},[s("div",{staticClass:"cells"},[s("div",{staticClass:"cell"},[s("div",{staticClass:"cell-hd"}),e._v(" "),s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.form.title,expression:"form.title"}],staticClass:"input",staticStyle:{"text-align":"left"},attrs:{placeholder:"请输入作业标题",maxlength:"20"},domProps:{value:e.form.title},on:{input:function(t){t.target.composing||e.$set(e.form,"title",t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"cell"},[s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.textContent,expression:"form.textContent"}],staticClass:"textarea",attrs:{rows:"6",placeholder:"请输入作业内容..."},domProps:{value:e.form.textContent},on:{input:function(t){t.target.composing||e.$set(e.form,"textContent",t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"cell"},[s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("ul",{staticClass:"uploader-files"},e._l(e.imagesList,function(t,a){return s("li",{key:a,staticClass:"uploader-file",style:{backgroundImage:"url("+t+")"}},[s("i",{staticClass:"iconfont icon-guanbi2fill",on:{click:function(t){t.stopPropagation(),e.handleDelImg(a)}}})])})),e._v(" "),s("div",{staticClass:"uploader-input_box",on:{click:e.handleChooseImage}})])]),e._v(" "),s("div",{staticClass:"cell cell-select cell-select-after"},[e._m(0),e._v(" "),s("div",{staticClass:"cell-bd"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"selected"}],staticClass:"select",attrs:{name:"select",dir:"rtl",multiple:"",size:"1"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.selected=t.target.multiple?s:s[0]}}},[s("optgroup",{attrs:{disabled:"",hidden:""}}),e._v(" "),e._l(e.classList,function(t,a){return s("option",{key:a,domProps:{value:t.classId}},[e._v(e._s(t.className))])})],2)])]),e._v(" "),s("div",{staticClass:"cell cell-switch"},[e._m(1),e._v(" "),s("div",{staticClass:"cell-ft"},[s("van-switch",{attrs:{size:"28px","active-color":"#92cd36"},model:{value:e.needSwitch,callback:function(t){e.needSwitch=t},expression:"needSwitch"}})],1)])])])]),e._v(" "),s("div",{staticClass:"btn-group"},[s("a",{staticClass:"btn btn-large btn-primary",attrs:{href:"javascript:void(0);"},on:{click:e.handleSubmit}},[e._v("发布")])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"cell-hd"},[t("label",{staticClass:"label",attrs:{for:""}},[this._v("发送班级")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[t("label",{staticClass:"label",attrs:{for:""}},[this._v("是否需要确定")])])}]};var v=s("VU/8")(f,m,!1,function(e){s("7hQ5")},"data-v-5ef7aec5",null);t.default=v.exports}});