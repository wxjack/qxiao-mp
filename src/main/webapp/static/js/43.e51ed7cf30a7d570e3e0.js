webpackJsonp([43],{QjhM:function(e,t){},kuy1:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Gu7T"),s=a.n(r),n=a("woOf"),i=a.n(n),o=a("+6Bu"),l=a.n(o),c=a("Xxa5"),u=a.n(c),d=a("exGp"),v=a.n(d),f=a("gyMJ"),m={name:"actionEdit",mixins:[a("0wMN").a],data:function(){return{form:{},chenkedList:[],dialogForm:{openId:this.$route.query.openId,actionId:this.$route.query.actionId,actionType:this.$route.query.actionType,ruleText:"",stressFlag:!0}}},methods:{onClose:function(e,t){var a=this;return function(r,s){switch(r){case"right":a.$dialog.confirm({title:"提示",message:"确认要删除该行为标准吗?"}).then(v()(u.a.mark(function r(){var n;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.close(),n={openId:a.$route.query.openId,actionType:a.$route.query.actionType,ruleId:t},r.next=4,f.a.ruleDelete(n);case 4:0===r.sent.errorCode&&a.form.rules.splice(e,1);case 6:case"end":return r.stop()}},r,a)}))).catch(function(){s.close()})}}},handleSubmit:function(e,t){var a=this;return v()(u.a.mark(function r(){var s,n,o;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("confirm"!==e){r.next=14;break}if(""!=a.dialogForm.ruleText){r.next=6;break}a.$toast("请输入评价标准"),t(!1),r.next=12;break;case 6:return s=a.dialogForm,n=s.stressFlag,o=l()(s,["stressFlag"]),n=n?1:0,r.next=10,f.a.ruleAdd(i()({},o,{stressFlag:n}));case 10:0===r.sent.errorCode&&(a.dialogForm.ruleText="",a.queryStudentRule(a.$route.query),t());case 12:r.next=15;break;case 14:t();case 15:case"end":return r.stop()}},r,a)}))()},handleSave:function(){var e=this;return v()(u.a.mark(function t(){var a,r,n,o,c,d,v,m,p,h;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.form,a.rules,r=a.actionId,n=a.actionType,o=l()(a,["rules","actionId","actionType"]),c=e.$route.query.openId,d=e.$route.query.studentId,v=i()({},o,{openId:c,actionId:r,actionType:n}),!e.chenkedList.length){t.next=20;break}return t.next=7,f.a.actionUpdate(v);case 7:if(0!==(m=t.sent).errorCode){t.next=17;break}return p=[].concat(s()(e.chenkedList)),h=i()({},{openId:c,studentId:d,actionId:r,actionType:n,rules:p}),t.next=13,f.a.ruleConnect(h);case 13:0===t.sent.errorCode&&e.$router.go(-1),t.next=18;break;case 17:-1===m.errorCode&&e.$toast(""+m.errorMsg);case 18:t.next=21;break;case 20:e.$toast("不能取消，请勾选标准");case 21:case"end":return t.stop()}},t,e)}))()},queryStudentRule:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v()(u.a.mark(function a(){var r,s;return u.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,f.a.queryStudentRule(t);case 2:0===(r=a.sent).errorCode&&(e.form=r.data,s=[],r.data.rules.forEach(function(e){e.choice&&s.push(e.ruleId)}),e.chenkedList=s);case 4:case"end":return a.stop()}},a,e)}))()}},mounted:function(){this.queryStudentRule(this.$route.query)}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flex-page"},[a("div",{staticClass:"flex-bd"},[a("van-dialog",{attrs:{title:"评价标准","show-cancel-button":"","before-close":e.handleSubmit},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[a("form",{ref:"form",staticClass:"form",attrs:{id:"form"}},[a("div",{staticClass:"form-tiem"},[a("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.dialogForm.ruleText,expression:"dialogForm.ruleText",modifiers:{trim:!0}}],staticClass:"textarea min-h400",attrs:{placeholder:"请输入评价标准",maxlength:"20"},domProps:{value:e.dialogForm.ruleText},on:{input:function(t){t.target.composing||e.$set(e.dialogForm,"ruleText",t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})]),e._v(" "),a("div",{staticClass:"form-tiem"},[a("van-checkbox",{model:{value:e.dialogForm.stressFlag,callback:function(t){e.$set(e.dialogForm,"stressFlag",t)},expression:"dialogForm.stressFlag"}},[e._v("是否侧重")])],1)])]),e._v(" "),a("div",{staticClass:"mod mb-30"},[a("div",{staticClass:"cells"},[a("div",{staticClass:"cell"},[a("div",{staticClass:"cell-hd"},[e._v("行为名称")]),e._v(" "),a("div",{staticClass:"cell-bd"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.title,expression:"form.title",modifiers:{trim:!0}}],staticClass:"input",attrs:{placeholder:"请输入行为名称",maxlength:"4"},domProps:{value:e.form.title},on:{input:function(t){t.target.composing||e.$set(e.form,"title",t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})])]),e._v(" "),a("div",{staticClass:"cell"},[a("div",{staticClass:"cell-hd"},[e._v("行为说明")]),e._v(" "),a("div",{staticClass:"cell-bd"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.textContent,expression:"form.textContent",modifiers:{trim:!0}}],staticClass:"input",attrs:{placeholder:"例如: 培养孩子坚持力",maxlength:"20"},domProps:{value:e.form.textContent},on:{input:function(t){t.target.composing||e.$set(e.form,"textContent",t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})])])])]),e._v(" "),e._m(0),e._v(" "),a("div",{staticClass:"rule-list"},[a("div",{staticClass:"cells"},e._l(e.form.rules,function(t,r){return a("van-swipe-cell",{key:r,ref:"swipeCell",refInFor:!0,attrs:{"right-width":60,"on-close":e.onClose(r,t.ruleId)}},[a("van-cell-group",[a("div",{staticClass:"cell"},[a("div",{staticClass:"cell-hd"},[a("van-checkbox-group",{model:{value:e.chenkedList,callback:function(t){e.chenkedList=t},expression:"chenkedList"}},[a("van-checkbox",{key:t.ruleId,ref:"checkboxes",refInFor:!0,attrs:{name:t.ruleId,"checked-color":"#1989fa"}})],1)],1),e._v(" "),a("div",{staticClass:"cell-bd pl-20"},[a("p",[e._v(e._s(t.ruleText))])]),e._v(" "),a("div",{staticClass:"cell-ft"},[t.stressFlag?a("van-rate",{attrs:{color:"#f44","void-color":"#eee",readonly:"",count:1},model:{value:t.stressFlag,callback:function(a){e.$set(t,"stressFlag",a)},expression:"item.stressFlag"}}):e._e()],1)])]),e._v(" "),a("span",{attrs:{slot:"right"},slot:"right"},[e._v("删除")])],1)}))])],1),e._v(" "),a("div",{staticClass:"page-ft"},[a("div",{staticClass:"tapeti"},[a("div",{staticClass:"tapeti-left"},[a("van-button",{attrs:{type:"default"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("新增评价标准")])],1),e._v(" "),a("div",{staticClass:"tapeti-right"},[a("van-button",{attrs:{type:"info"},on:{click:e.handleSave}},[e._v("确认")])],1)])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"cells-title"},[t("p",[this._v("评价标准")]),this._v(" "),t("a",{attrs:{href:"javascript:void(0);"}},[this._v("侧重")])])}]};var h=a("VU/8")(m,p,!1,function(e){a("QjhM")},"data-v-1d6afc66",null);t.default=h.exports}});