webpackJsonp([20],{rDpM:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Xxa5"),n=s.n(a),i=s("exGp"),r=s.n(i),o=s("woOf"),l=s.n(o),c=s("+6Bu"),d=s.n(c),u=s("Dd8w"),m=s.n(u),f=s("gyMJ"),v=s("NYxO"),p={name:"community",data:function(){return{imagesList:[],serverId:[],form:{openId:this.$route.query.openId,classId:this.$route.query.classId,studentId:this.$route.query.studentId,contentType:0,textContent:"",images:[],video:""}}},computed:m()({},Object(v.b)("queryClass",{classList:function(t){return t.classList}})),methods:{handleChooseImage:function(){var t=this;wx.chooseImage({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var s=e.localIds;window.__wxjs_is_wkwebview?t.handleLocalImgData(s):s.forEach(function(e){t.imagesList.push(e)}),t.handleUploadImage(s)},fail:function(t){alert("失败")}})},handlePreviewImage:function(t){wx.previewImage({current:t,urls:this.imagesList})},handleUploadImage:function(t){var e=this,s=0,a=t.length;!function n(){var i=t[s];window.__wxjs_is_wkwebview&&-1!=i.indexOf("wxlocalresource")&&(i=i.replace("wxlocalresource","wxLocalResource")),wx.uploadImage({localId:i,isShowProgressTips:1,success:function(t){var i=t.serverId;e.serverId.push(i),++s<a&&n()},fail:function(t){alert("失败")}})}()},handleLocalImgData:function(t){var e=this,s=0,a=t.length;!function n(){wx.getLocalImgData({localId:t[s],success:function(t){var i=t.localData;i=i.replace("jgp","jpeg"),e.imagesList.push(i),++s<a&&n()}})}()},handleDelImg:function(t){this.imagesList.splice(t,1),this.serverId.splice(t,1)},handleSubmit:function(){var t=this,e=this.form,s=e.textContent,a=d()(e,["textContent"]);if(""!=s||this.serverId.length){var n={openId:this.$store.getters.openId,imgIds:this.serverId},i=l()({},a,{textContent:s});this.serverId.length?f.a.imgIds(n).then(function(e){0===e.errorCode&&(i.images=e.data.paths,f.a.communityAdd(i).then(function(e){0===e.errorCode&&t.$router.go(-1)}))}):this.communityAdd(i)}else this.$toast("请输入内容或者上传图片")},communityAdd:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r()(n.a.mark(function s(){var a;return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,f.a.communityAdd(e);case 2:0===(a=s.sent).errorCode?t.$router.go(-1):-1===a.errorCode&&t.$toast(""+a.errorMsg);case 4:case"end":return s.stop()}},s,t)}))()}},mounted:function(){}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page"},[s("div",{staticClass:"page-bd",staticStyle:{"background-color":"#fff"}},[s("form",{ref:"form",attrs:{action:"",method:"post"}},[s("div",{staticClass:"cells"},[s("div",{staticClass:"cell"},[s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.textContent,expression:"form.textContent"}],staticClass:"textarea",attrs:{placeholder:"记录下孩子的成长点滴...",rows:"10"},domProps:{value:t.form.textContent},on:{input:function(e){e.target.composing||t.$set(t.form,"textContent",e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"cell"},[s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("ul",{staticClass:"uploader-files"},t._l(t.imagesList,function(e,a){return s("li",{key:a,staticClass:"uploader-file",style:{backgroundImage:"url("+e+")"},on:{click:function(s){t.handlePreviewImage(e)}}},[s("i",{staticClass:"iconfont icon-guanbi2fill",on:{click:function(e){e.stopPropagation(),t.handleDelImg(a)}}})])})),t._v(" "),s("div",{staticClass:"uploader-input_box",on:{click:t.handleChooseImage}})])]),t._v(" "),s("div",{staticClass:"cell cell-input cell-input-after"},[t._m(0),t._v(" "),s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.form.classId,expression:"form.classId"}],staticClass:"select",attrs:{name:"select",dir:"rtl"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.form,"classId",e.target.multiple?s:s[0])}}},t._l(t.classList,function(e,a){return s("option",{key:a,domProps:{value:e.classId}},[t._v(t._s(e.className))])}))])])])])]),t._v(" "),s("div",{staticClass:"btn-group"},[s("a",{staticClass:"btn btn-large btn-primary",attrs:{href:"javascript:;",id:"btn-Submission"},on:{click:t.handleSubmit}},[t._v("发布")])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"cell-hd"},[e("label",{staticClass:"label",attrs:{for:""}},[this._v("发送班级")])])}]};var g=s("VU/8")(p,h,!1,function(t){s("xcym")},"data-v-a709f672",null);e.default=g.exports},xcym:function(t,e){}});