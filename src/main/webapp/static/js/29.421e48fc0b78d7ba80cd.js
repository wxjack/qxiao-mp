webpackJsonp([29],{Uvxj:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("Xxa5"),a=s.n(n),i=s("exGp"),o=s.n(i),r=s("gyMJ"),c={name:"freshShow",data:function(){return{dialogVisible:!1,query:{openId:this.$route.query.openId,freshId:this.$route.query.freshId,classId:this.$route.query.classId,studentId:this.$route.query.studentId},roleType:this.$route.query.roleType,form:{openId:this.$route.query.openId,freshId:this.$route.query.freshId,textContent:"",studentId:this.$route.query.studentId,classId:this.$route.query.classId},commentLen:0,info:{}}},methods:{handleDelComment:function(t,e){var s=this,n=this.query.openId;this.$dialog.confirm({title:"提示",message:"确定要删除该条留言？"}).then(function(){s.info.commentList.splice(e,1),s.deleteComment({openId:n,commentId:t})}).catch(function(){})},handleSubmit:function(t,e){"confirm"===t?""==this.form.textContent?(this.$toast("请输入评论内容"),e(!1)):(this.freshCommentAdd(this.form),e()):e()},deleteComment:function(t){var e=this;return o()(a.a.mark(function s(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.deleteComment(t);case 2:e.sent;case 3:case"end":return e.stop()}},s,e)}))()},freshDetail:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o()(a.a.mark(function s(){var n;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.a.freshDetail(e);case 2:0===(n=s.sent).errorCode&&(n.data.isDel?t.$dialog.alert({showConfirmButton:!1,message:"内容已被删除"}):(t.info=n.data,t.commentLen=n.data.commentList.length));case 4:case"end":return s.stop()}},s,t)}))()},freshCommentAdd:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o()(a.a.mark(function s(){var n;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.a.freshCommentAdd(e);case 2:0===(n=s.sent).errorCode?(t.dialogVisible=!1,t.form.textContent="",t.freshDetail(t.query)):-1===n.errorCode&&t.$toast(""+n.errorMsg);case 4:case"end":return s.stop()}},s,t)}))()}},activated:function(){this.freshDetail(this.query)}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page"},[s("div",{staticClass:"page-bd"},[s("article",{staticClass:"article"},[s("h1",{attrs:{"size-24":""}},[t._v(t._s(t.info.title))]),t._v(" "),s("div",{staticClass:"article-hd"},[s("div",{staticClass:"article-cell"},[s("span",[t._v(t._s(t.info.schoolName))])]),t._v(" "),s("div",{staticClass:"article-cell"},[s("time",[t._v(t._s(t.info.postTime))])]),t._v(" "),s("div",{staticClass:"article-cell"},[s("van-icon",{attrs:{name:"eye-o",size:"16px"}}),t._v(" "),s("b",[t._v(t._s(t.info.classReadCount))])],1)]),t._v(" "),s("section",{staticClass:"article-content",attrs:{"size-16":""}},[s("p",{domProps:{innerHTML:t._s(t.info.textContent)}}),t._v(" "),t.info.images?t._l(t.info.images,function(t,e){return s("p",{key:e},[s("img",{attrs:{src:t.imageUrl}})])}):t._e()],2)]),t._v(" "),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-hd flex"},[s("span",[t._v("留言("+t._s(t.commentLen)+")")]),t._v(" "),3==t.roleType?[s("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("写留言")])]:t._e()],2),t._v(" "),s("div",{staticClass:"comment-bd"},[s("div",{staticClass:"cells"},t._l(t.info.commentList,function(e,n){return s("div",{key:n,staticClass:"cell"},[s("div",{staticClass:"cell-hd"},[s("img",{staticClass:"icon",attrs:{src:e.photo,alt:""}})]),t._v(" "),s("div",{staticClass:"cell-bd"},[s("span",[t._v(t._s(e.name))]),t._v(" "),s("p",[t._v(t._s(e.textContent))])]),t._v(" "),1==t.roleType||2==t.roleType||4==t.roleType?[s("div",{staticClass:"cell-ft"},[s("p",{staticStyle:{color:"#e64340"},on:{click:function(s){t.handleDelComment(e.commentId,n)}}},[t._v("删除")])])]:t._e()],2)}))])]),t._v(" "),s("van-dialog",{attrs:{title:"评论","show-cancel-button":"","before-close":t.handleSubmit},on:{cancel:function(e){t.dialogVisible=!1}},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[s("div",{staticClass:"comment-form"},[s("form",{ref:"form",attrs:{action:"",method:"post"}},[s("div",{staticClass:"cells",staticStyle:{padding:"15px 0 15px 0"}},[s("div",{staticClass:"cell"},[s("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.textContent,expression:"form.textContent"}],staticClass:"textarea",attrs:{placeholder:"请输入留言内容...",rows:"6"},domProps:{value:t.form.textContent},on:{input:function(e){e.target.composing||t.$set(t.form,"textContent",e.target.value)}}})])])])])])])],1)])},staticRenderFns:[]};var d=s("VU/8")(c,l,!1,function(t){s("aQNM")},"data-v-52bb15c4",null);e.default=d.exports},aQNM:function(t,e){}});