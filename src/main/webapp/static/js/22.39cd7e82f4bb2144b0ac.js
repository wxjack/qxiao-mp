webpackJsonp([22],{"05zy":function(a,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=s("Xxa5"),l=s.n(e),n=s("exGp"),i=s.n(n),r=s("Dd8w"),o=s.n(r),c=s("oqQY"),u=s.n(c),d=s("gyMJ"),p=s("NYxO"),h={name:"shuttle",data:function(){return{popupShow:!1,className:this.$route.query.className,query:{openId:this.$route.query.openId,classId:this.$route.query.classId,date:u()().format("YYYY-MM-DD")},shuttleData:[],classClockData:[],isAndroid:!1,playBoolean:!0,playIndex:0,playUrl:"",playList:[],playNumber:1,playMax:2,playTimer:null}},watch:{playUrl:function(a,t){var s=this.$refs.audioRef;this.$nextTick(function(){a?s.play():s.pause()})}},computed:o()({},Object(p.b)("queryClass",{classList:function(a){return a.classList}})),methods:{handleClassConfirm:function(a,t){this.className=a.className,this.query.classId=a.classId,this.classClockQuery(),this.realShuttle(this.query)},handlePlay:function(a){},handlePlaying:function(a){},handlePause:function(a){},handleEnded:function(a){var t=this,s=this.$refs.audioRef;this.playNumber===this.playMax?setTimeout(function(){t.playNumber=1,t.playIndex++,t.playIndex<t.playList.length?(t.playUrl=t.playList[t.playIndex].url,t.playUrl===s.src&&s.play()):(t.playIndex=0,t.playUrl="",t.playBoolean=!1,t.classClockQuery(),t.realShuttle(t.query))},1e3):(this.playNumber++,this.$refs.audioRef.play())},handlePlayAudio:function(){var a=document.getElementById("audios");this.playUrl?a.paused?(a.play(),this.playBoolean=!1):(a.pause(),this.playBoolean=!0):this.$toast("暂无学生打卡")},handleOnload:function(){var a=window.navigator.userAgent.toLowerCase();/android/i.test(a)&&"micromessenger"==a.match(/MicroMessenger/i)?this.isAndroid=!1:this.isAndroid=!0},realShuttle:function(){var a=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(l.a.mark(function s(){var e;return l.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,d.a.realShuttle(t);case 2:0===(e=s.sent).errorCode&&(e.data.length?(clearInterval(a.playTimer),a.shuttleData=e.data,a.playList=a.shuttleData.map(function(a){return{url:a.url}}),a.playUrl=a.playList[a.playIndex].url||""):(a.shuttleData=[],clearInterval(a.playTimer),a.playTimer=setInterval(function(){console.log("10秒后重新请求"),a.realShuttle(a.query)},1e4)));case 4:case"end":return s.stop()}},s,a)}))()},classClockQuery:function(){var a=this;return i()(l.a.mark(function t(){var s,e,n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=a.query,e=s.openId,n=s.classId,t.next=3,d.a.classClockQuery({openId:e,classId:n});case 3:0===(i=t.sent).errorCode&&(a.popupShow=!1,a.classClockData=i.data);case 5:case"end":return t.stop()}},t,a)}))()}},mounted:function(){this.handleOnload(),this.classClockQuery(),this.realShuttle(this.query)},destroyed:function(){clearInterval(this.playTimer),console.log("destroyed")}},y={render:function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"page"},[s("div",{staticClass:"page-hd"},[s("audio",{ref:"audioRef",attrs:{id:"audios",src:a.playUrl},on:{play:a.handlePlay,ended:a.handleEnded,playing:a.handlePlaying,pause:a.handlePause}}),a._v(" "),s("div",{staticClass:"shuttle-sp-area flex",attrs:{"size-17":""}},[s("a",{attrs:{href:"javascript:;",id:"showDatePicker"},on:{click:function(t){a.popupShow=!0}}},[s("span",[a._v(a._s(a.className))]),a._v(" "),s("van-icon",{attrs:{name:"arrow-down",size:"16px"}})],1),a._v(" "),s("div",{staticClass:"audio-box",on:{click:a.handlePlayAudio}},[a.isAndroid?[a.playBoolean?s("van-icon",{attrs:{name:"play-circle-o",size:"40px"}}):s("van-icon",{attrs:{name:"pause-circle-o",size:"40px"}})]:a._e()],2)])]),a._v(" "),s("div",{staticClass:"page-bd"},[s("van-popup",{attrs:{position:"bottom"},model:{value:a.popupShow,callback:function(t){a.popupShow=t},expression:"popupShow"}},[s("van-picker",{attrs:{columns:a.classList,"show-toolbar":"","value-key":"className"},on:{cancel:function(t){a.popupShow=!1},confirm:a.handleClassConfirm}})],1),a._v(" "),[s("div",{staticClass:"table"},[a._m(0),a._v(" "),s("div",{staticClass:"table-body"},[s("div",{staticClass:"tr"},a._l(a.classClockData,function(t,e){return s("div",{key:e,staticClass:"td",class:[t.clockFlag?"td-success":"td-default"]},[s("div",[t.photo?s("img",{attrs:{src:t.photo}}):s("div",{staticClass:"icon-d"}),a._v(" "),s("div",{},[s("span",[a._v(a._s(t.studentName))])])])])}))])]),a._v(" "),s("div",{staticClass:"cells",staticStyle:{"margin-top":"15px"}},a._l(a.shuttleData,function(t,e){return s("div",{key:e,staticClass:"cell"},[s("div",{staticClass:"cell-hd"},[s("label",{staticClass:"label",attrs:{for:""}},[a._v(a._s(t.studentName))])]),a._v(" "),s("div",{staticClass:"cell-bd"},[s("p",{staticClass:"cell-p"},[a._v(a._s(t.postTime))])]),a._v(" "),s("div",{staticClass:"cell-ft"})])}))]],2)])},staticRenderFns:[function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"table-head"},[t("div",{staticClass:"tr"},[t("div",{staticClass:"th"},[t("i",{staticStyle:{"background-color":"#92cd36"}}),this._v(" "),t("span",{attrs:{"size-14":""}},[this._v("已打卡")])]),this._v(" "),t("div",{staticClass:"th"},[t("i",{staticStyle:{"background-color":"#e5e5e5"}}),this._v(" "),t("span",{attrs:{"size-14":""}},[this._v("未打卡")])])])])}]};var v=s("VU/8")(h,y,!1,function(a){s("jKcK")},"data-v-96e2eb0c",null);t.default=v.exports},jKcK:function(a,t){}});