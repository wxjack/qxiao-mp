webpackJsonp([9],{KR8f:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("+6Bu"),a=n.n(i),s=n("Xxa5"),o=n.n(s),c=n("exGp"),r=n.n(c),u=n("Fd2+"),l=n("gyMJ"),m={name:"qmenu",data:function(){return{roleType:this.$route.query.roleType,type:this.$route.query.type,recipeList:[{name:"营养食谱",url:"/recipe",icon:"./static/image/men-icon-9@2x.png"}],shuttleList:[{name:"实时接送",url:"/shuttle",icon:"./static/image/men-icon-6@2x.png"}],clockList:[{name:"考勤记录",url:"/clock",icon:"./static/image/men-icon-3@2x.png"}],schoolList:[{name:"班级管理",url:"/class",icon:"./static/image/men-icon-1@2x.png"},{name:"老师管理",url:"/teacher",icon:"./static/image/men-icon-4@2x.png"}],teacherList:[{name:"学生管理",url:"/student",icon:"./static/image/men-icon-10@2x.png"}],homeworkList:[],menuList:[{name:"通知公告",url:"/notice",icon:"./static/image/men-icon-7@2x.png"},{name:"亲子作业",url:"/homework",icon:"./static/image/men-icon-5@2x.png"},{name:"新鲜速报",url:"/fresh",icon:"./static/image/men-icon-8@2x.png"},{name:"班级相册",url:"/album",icon:"./static/image/men-icon-2@2x.png"}]}},computed:{computedMenu:function(){if(0==this.type)switch(parseInt(this.roleType)){case 1:return this.menuList.concat(this.recipeList).concat(this.clockList).concat(this.schoolList);case 2:return this.menuList.concat(this.recipeList).concat(this.clockList).concat(this.teacherList).concat(this.shuttleList);case 3:return this.menuList.concat(this.recipeList).concat(this.clockList);default:return this.menuList.concat(this.recipeList).concat(this.clockList).concat(this.schoolList)}else if(1==this.type)switch(parseInt(this.roleType)){case 1:return this.menuList.concat(this.schoolList);case 2:return this.menuList.concat(this.teacherList);case 3:return this.menuList;default:return this.menuList.concat(this.schoolList)}}},methods:{chanage:function(t){this.$emit("on-change",t,this.$route.query)}}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("nav",{staticClass:"nav"},t._l(t.computedMenu,function(e,i){return n("div",{key:i,staticClass:"langur",on:{click:function(n){t.chanage(e.url)}}},[n("img",{attrs:{src:e.icon,width:"57",height:"57"}}),t._v(" "),n("div",{staticClass:"text-ellipsis"},[t._v(t._s(e.name))])])}))},staticRenderFns:[]};var h=n("VU/8")(m,d,!1,function(t){n("dTv4")},"data-v-6547f98f",null).exports,p=n("Dd8w"),f=n.n(p),y=n("NYxO"),v={name:"community",props:{data:{type:Array,required:!0,default:function(){return[]}}},data:function(){return{showMore:!1}},filters:{capitalize:function(t){return t+","}},computed:f()({},Object(y.b)("users",{roleType:function(t){return t.roleType}})),methods:{handleLiHeight:function(){var t=this;this.$nextTick(function(){var e=t.$refs.li[0].height;e&&(console.log(e),console.log("OK"))})},handlePreviewImage:function(t,e){if(e.length){var n=[];e.forEach(function(t){n.push(t.imageUrl)}),Object(u.l)({images:n,startPosition:t})}},handleCommunityDelete:function(t,e){this.$emit("on-del",t,e)},handlePraise:function(t,e){this.$emit("on-praise",t,e)},handleComment:function(t,e){this.$emit("on-comment",t,e)}},mounted:function(){}},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"community"},t._l(t.data,function(e,i){return n("div",{key:e.communityId,staticClass:"box"},[n("div",{staticClass:"cell"},[n("div",{staticClass:"cell-hd"},[e.photo?n("img",{attrs:{src:e.photo}}):t._e()]),t._v(" "),n("div",{staticClass:"cell-bd"},[n("h5",{attrs:{"size-15":""}},[t._v(t._s(e.name))]),t._v(" "),n("p",{attrs:{"size-15":""}},[t._v(t._s(e.textContent))]),t._v(" "),[n("div",{staticClass:"img-group"},t._l(e.images,function(i,a){return n("div",{key:a,staticClass:"item",style:{backgroundImage:"url("+i.imageUrl+")"},on:{click:function(n){t.handlePreviewImage(a,e.images)}}})}))],t._v(" "),n("div",{staticClass:"handle"},[n("div",{staticClass:"left"},[n("time",[t._v(t._s(e.postTime))]),t._v(" "),1==t.roleType||2==t.roleType||4==t.roleType?[n("span",{staticClass:"del",on:{click:function(n){t.handleCommunityDelete(e,i)}}},[t._v("删除")])]:t._e()],2),t._v(" "),n("div",{staticClass:"right"},[n("van-icon",{attrs:{name:"like",size:"20px"},on:{click:function(n){t.handlePraise(e,i)}}}),t._v(" "),n("van-icon",{attrs:{name:"comment",size:"20px"},on:{click:function(n){t.handleComment(e,i)}}})],1)]),t._v(" "),n("div",{staticClass:"data"},[e.praiseList.length?[n("div",{staticClass:"zan-list"},[n("i",{staticClass:"iconfont icon-zantong"}),t._v(" "),t._l(e.praiseList,function(e,i){return n("span",{key:i},[t._v(t._s(t._f("capitalize")(e.studentName)))])})],2)]:t._e(),t._v(" "),e.commentList.length?[n("ul",{staticClass:"comment-list"},t._l(e.commentList,function(e,i){return n("li",{key:i,ref:"li",refInFor:!0},[n("span",[t._v(t._s(e.studentName)+":")]),t._v(" "),n("span",{staticStyle:{color:"#252525"}},[t._v(t._s(e.textContent))])])}))]:t._e()],2)],2)])])}))},staticRenderFns:[]};var x=n("VU/8")(v,g,!1,function(t){n("T7aK")},null,null).exports,C=n("TVmP"),_={name:"home",mixins:[n("a9+M").a],components:{qxMenu:h,qxCommunity:x,qxFooter:C.a},data:function(){return{studentPicker:!1,popupShow:!1,dialogVisible:!1,className:this.$route.query.className,isLoading:!1,totalPage:1,isOpen:this.$route.query.isOpen,roleType:this.$route.query.roleType,id:this.$route.query.id,query:{classId:this.$route.query.classId,openId:this.$route.query.openId,studentId:this.$route.query.studentId,page:1,pageSize:10},communityData:[],classList:[],form:{index:null,openId:this.$route.query.openId,studentId:this.$route.query.studentId,communityId:null,textContent:""}}},filters:{capitalize:function(t){return t+","}},methods:{go:function(t,e){t&&this.$router.push({path:""+t,query:e})},onChange:function(t,e){t.setColumnValues(1,citys[e[0]])},handleClassConfirm:function(t,e){this.className=t.className,this.query.classId=t.classId,this.communityQuery(this.query)},handlePraise:function(t,e){var n=this;return r()(o.a.mark(function i(){var a,s,c,r,u;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=n.$route.query.openId,s=n.$route.query.studentId,c=t.communityId,i.next=5,l.a.communityPraise({openId:a,communityId:c,studentId:s});case 5:0===(r=i.sent).errorCode&&(n.communityData[e].praiseList||(n.communityData[e].praiseList=[]),r.data?n.communityData[e].praiseList.push(r.data):(u=n.communityData[e].praiseList.filter(function(t){return t.openId!==a&&t.studentId!==s}),console.log(u),n.communityData[e].praiseList=u.length?u:[]));case 7:case"end":return i.stop()}},i,n)}))()},handleComment:function(t,e){this.dialogVisible=!0,this.form.communityId=t.communityId,this.form.index=e},handleSubmit:function(t,e){var n=this;return r()(o.a.mark(function i(){var s,c,r,u;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(s=n.form,c=s.index,r=a()(s,["index"]),"confirm"!==t){i.next=14;break}if(""!=n.form.textContent){i.next=7;break}n.$toast("请输入评论内容"),e(!1),i.next=12;break;case 7:return n.communityData[c].commentList||(n.communityData[c].commentList=[]),i.next=10,l.a.communityComment(r);case 10:0===(u=i.sent).errorCode&&(n.dialogVisible=!1,n.form.textContent="",n.communityData[c].commentList.push(u.data),e());case 12:i.next=15;break;case 14:e();case 15:case"end":return i.stop()}},i,n)}))()},handleCommunityDelete:function(t,e){var n=this,i=t.openId,a=t.communityId;i&&a&&this.$dialog.confirm({title:"提示",message:"确实要删除该条班级圈吗?"}).then(function(){n.communityData.splice(e,1),n.communityDelete({openId:i,communityId:a})}).catch(function(){})},handleLoadingMore:function(t){var e=this,n=0;document.documentElement&&document.documentElement.scrollTop?n=document.documentElement.scrollTop:document.body&&(n=document.body.scrollTop),document.body.offsetHeight-n-window.innerHeight<=200&&!1===this.isLoading&&this.query.page<this.totalPage&&(this.isLoading=!0,this.query.page+=1,l.a.communityQuery(this.query).then(function(t){if(0===t.errorCode){e.popupShow=!1,e.totalPage=t.data.totalPage,e.query.page=t.data.page,e.isLoading=!1;var n=t.data.data;n.length&&n.forEach(function(t){e.communityData.push(t)})}}))},communityQuery:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r()(o.a.mark(function n(){var i,a;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.communityQuery(e);case 2:0===(i=n.sent).errorCode&&(a=i.data.data||[],t.query.page=i.data.page,t.totalPage=i.data.totalPage,t.isLoading=!1,t.popupShow=!1,t.communityData=a);case 4:case"end":return n.stop()}},n,t)}))()},communityDelete:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r()(o.a.mark(function n(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.communityDelete(e);case 2:t.sent.errorCode;case 4:case"end":return t.stop()}},n,t)}))()},queryClassGroup:function(){var t=this;return r()(o.a.mark(function e(){var n,i,a,s,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$route.query,i=n.id,a=n.studentId,s=n.roleType,e.next=3,l.a.queryClassId({id:i,studentId:a,roleType:s});case 3:0===(c=e.sent).errorCode&&(t.classList=c.data);case 5:case"end":return e.stop()}},e,t)}))()}},mounted:function(){this.queryClassGroup(),this.wxSdk.wxShare(this.roleType),this.communityQuery(this.query)}},L={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flex-page"},[n("div",{staticClass:"flex-bd"},[n("qx-menu",{on:{"on-change":t.go}}),t._v(" "),n("van-popup",{attrs:{position:"bottom"},model:{value:t.popupShow,callback:function(e){t.popupShow=e},expression:"popupShow"}},[n("van-picker",{attrs:{columns:t.classList,"show-toolbar":"","value-key":"className"},on:{cancel:function(e){t.popupShow=!1},confirm:t.handleClassConfirm}})],1),t._v(" "),t.isOpen?[n("router-link",{staticClass:"release",attrs:{to:{path:"/community",query:this.$route.query}}},[n("van-icon",{attrs:{name:"description",size:"24px"}})],1)]:t._e(),t._v(" "),n("main",{staticClass:"main"},[n("div",{staticClass:"classId"},[n("div",{on:{click:function(e){t.popupShow=!0}}},[n("span",[t._v(t._s(t.className))]),t._v(" "),n("van-icon",{attrs:{name:"arrow-down",size:"16px"}})],1)]),t._v(" "),n("qx-community",{attrs:{data:t.communityData},on:{"on-del":t.handleCommunityDelete,"on-praise":t.handlePraise,"on-comment":t.handleComment}})],1),t._v(" "),n("van-dialog",{attrs:{title:"评论","show-cancel-button":"","before-close":t.handleSubmit},on:{cancel:function(e){t.dialogVisible=!1}},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[n("div",{staticClass:"comment-form"},[n("form",{ref:"form",attrs:{action:"",method:"post"}},[n("div",{staticClass:"cells",staticStyle:{padding:"15px 0 15px 0"}},[n("div",{staticClass:"cell"},[n("div",{staticClass:"cell-bd",staticStyle:{"padding-left":"0"}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.textContent,expression:"form.textContent"}],staticClass:"textarea",attrs:{placeholder:"请输入评论内容...",rows:"6"},domProps:{value:t.form.textContent},on:{input:function(e){e.target.composing||t.$set(t.form,"textContent",e.target.value)}}})])])])])])])],2),t._v(" "),n("div",{staticClass:"flex-ft"},[n("qx-footer")],1)])},staticRenderFns:[]};var k=n("VU/8")(_,L,!1,function(t){n("Vn/g")},"data-v-09f5e872",null);e.default=k.exports},T7aK:function(t,e){},"Vn/g":function(t,e){},dTv4:function(t,e){}});